{% comment %}
  Snippet: Check Total Spent Lock
  Usage: {% render 'check-total-spent-lock', customer: customer %}
  Outputs: 1 (locked) or 0 (unlocked)
  
  Logic: 
  - Trả về 1 (LOCKED) nếu customer chưa mua hàng (total_spent = 0 hoặc blank)
  - Trả về 0 (UNLOCKED) nếu customer đã mua hàng (total_spent > 0)
{% endcomment %}

{% assign is_locked = 1 %}

{% if customer %}
  {% if customer.metafields.custom.total_spent != blank and customer.metafields.custom.total_spent != 0 %}
    {% assign total_spent = customer.metafields.custom.total_spent | plus: 0 %}
    {% if total_spent > 0 %}
      {% assign is_locked = 0 %}
    {% endif %}
  {% else %}
    {% comment %} Fallback to Shopify total_spent (in cents) {% endcomment %}
    {% assign total_spent = customer.total_spent | plus: 0 %}
    {% if total_spent > 0 %}
      {% assign is_locked = 0 %}
    {% endif %}
  {% endif %}
{% endif %}

{{ is_locked }}
