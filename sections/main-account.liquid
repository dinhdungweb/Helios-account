{{ 'account.css' | asset_url | stylesheet_tag: preload: true }}

{% comment %}Import Logic{% endcomment %}
{% include 'account-tier-logic' %}

<div class="wide-container customer-account-container">
  {% comment %}Render Sidebar{% endcomment %}
  {% include 'account-sidebar' %}

  <div class="customer-content">
    {% comment %}--- TAB: WELCOME ---{% endcomment %}
    <div id="rewards" class="customer-tab-content active">
      <div class="custom-tier-content">
        {% render 'account-tier-content', tier: tier, type: 'welcome' %}
      </div>
      <div class="reward-tiers">
        <div class="tier">
          {% if section.settings.tier_image != blank %}
            <img src="{{ section.settings.tier_image | image_url: width: 800 }}" alt="Tier Image" loading="lazy"/>
          {% else %}
             {% comment %}Fallback to existing hardcoded image if not set{% endcomment %}
             <img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/SRK00644-2.jpg?v=1764068164" alt=""/>
          {% endif %}
        </div>
      </div>
    </div>

    {% comment %}--- TAB: ACCOUNT INFO ---{% endcomment %}
    <div id="account" class="customer-tab-content">
      <h3 style="text-align:left">Chi tiết tài khoản</h3>
      <p><strong>Họ và tên:</strong> {{ customer.name }}</p>
      <p><strong>Số điện thoại:</strong> {{ customer.default_address.phone }}</p>
      <p><strong>Email:</strong> {{ customer.email }}</p>
      <p><strong>Địa chỉ:</strong> 
        {% for address in customer.addresses %}
          {{ address.company }} {{ address.street }}, {{ address.city }} {% if address.province_code %}, {{ address.province_code }}{% endif %}, {{ address.country }} {{ address.zip }}
        {% endfor %}
      </p>
      <a class="logout-button" href="{{ routes.account_addresses_url }}">Sửa thông tin</a>
    </div>

    {% comment %}--- TAB: ORDERS ---{% endcomment %}
    <div id="orders" class="customer-tab-content">
      <h3 style="text-align:left">Đơn hàng</h3>
      {% paginate customer.orders by 20 %}
      {% if customer.orders.size != 0 %}
      <table class="orders-table">
        <thead>
          <tr>
            <th>Order</th>
            <th>Date</th>
            <th>Status</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for order in customer.orders %}
          <tr>
            <td><a href="{{ order.customer_url }}">{{ order.name }}</a></td>
            <td>{{ order.created_at | date: format: 'month_date_year' }}</td>
            <td>{{ order.financial_status_label }}</td>
            <td>{{ order.total_price | money }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}<p>No orders found.</p>{% endif %}
      {% endpaginate %}
    </div>

    {% comment %}--- TAB: BENEFITS ---{% endcomment %}
    <div id="benefits" class="customer-tab-content">
      <h3 style="text-align:left">Benefits & Promos</h3>
      <div class="custom-tier-content">
        {% render 'account-tier-content', tier: tier, type: 'benefits' %}
      </div>
    </div>

    {% comment %}--- TAB: COMMUNITY (Legacy) ---{% endcomment %}
    <div id="discord" class="customer-tab-content">
      <h3 style="text-align:left; margin-bottom: 20px;">Helios Community</h3>
      <div style="margin-bottom: 20px;"><img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/z6465765703069_030e64083cc975d6127ff8a441409631_95f8c0e0-1f78-4f16-b036-4de58aa1d26c.jpg?v=1743569814" alt=""/></div>
      <p>Helios Club là cộng đồng dành riêng cho những người ‘khác biệt’– những anh em quan tâm đến thời trang, phụ kiện và đặc biệt là những ai đam mê ‘màu’ Helios.</p>
          
      <p>Đây là nơi để anh em chia sẻ trải nghiệm, kinh nghiệm sử dụng phụ kiện, những câu chuyện phía sau món đồ; đồng thời là không gian mở để đặt câu hỏi, tư vấn, trao đổi và thảo luận một cách thẳng thắn và chân thành.</p>
          
      <p>Nếu bạn yêu thích sự khác biệt: Chào mừng bạn đến với Helios Club!</p>
      <a href="https://www.facebook.com/groups/508707569692422" title=""><button>Tham gia ngay</button></a>
    </div>

    {% comment %}--- CUSTOM TABS (Dynamic) ---{% endcomment %}
    {% for block in section.blocks %}
      {% if block.type == 'custom_tab' %}
        <div id="custom-tab-{{ block.id }}" class="customer-tab-content">
           <h3 style="text-align:left">{{ block.settings.title }}</h3>
           {% if block.settings.page_content != blank %}
             {{ pages[block.settings.page_content].content }}
           {% else %}
             <div class="rte">
               {{ block.settings.richtext_content }}
             </div>
           {% endif %}
        </div>
      {% endif %}
    {% endfor %}

  </div>
</div>

<script>
document.querySelectorAll('.tab-link').forEach(tab => {
  tab.addEventListener('click', function () {
    const tabId = this.dataset.tab;
    
    // Deactivate all
    document.querySelectorAll('.tab-link').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.customer-tab-content').forEach(el => el.classList.remove('active'));
    
    // Activate clicked
    this.classList.add('active');
    const content = document.getElementById(tabId);
    if(content) content.classList.add('active');
  });
});
</script>

{% schema %}
{
  "name": "Main Account",
  "settings": [
    {
      "type": "image_picker",
      "id": "tier_image",
      "label": "Ảnh trang chủ Hạng (Mặc định)"
    }
  ],
  "blocks": [
    {
      "type": "tier_config",
      "name": "Cấu hình Hạng",
      "settings": [
        {
          "type": "text",
          "id": "tier_tag",
          "label": "Thẻ khách hàng (Tag)",
          "info": "Ví dụ: SILVER, GOLD, MEMBER"
        },
        {
          "type": "richtext",
          "id": "welcome_message",
          "label": "Lời chào mừng",
           "default": "<p>Chào mừng bạn đến với Helios!</p>"
        },
        {
          "type": "richtext",
          "id": "benefits_content",
          "label": "Nội dung Quyền lợi"
        }
      ]
    },
    {
      "type": "custom_tab",
      "name": "Tab Tùy Chỉnh",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Tiêu đề Tab",
          "default": "Tab Mới"
        },
        {
          "type": "page",
          "id": "page_content",
          "label": "Nội dung từ Trang (Ưu tiên)"
        },
        {
          "type": "richtext",
          "id": "richtext_content",
          "label": "Nội dung văn bản"
        }
      ]
    },
    {
       "type": "@app"
    }
  ]
}
{% endschema %}
