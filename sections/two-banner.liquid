{%- liquid
  assign section_classes = 'two-banner two-banner--' | append: section.id

  assign block_count = section.blocks.size | at_least: 1

  assign cols_mobile  = section.settings.columns_mobile  | default: '1' | plus: 0 | at_least: 1 | at_most: 2 | at_most: block_count
  assign cols_desktop = section.settings.columns_desktop | default: 2   | plus: 0 | at_least: 1 | at_most: 6 | at_most: block_count

  assign mobile_vw  = 100 | divided_by: cols_mobile
  assign desktop_vw = 100 | divided_by: cols_desktop
-%}

<div id="section-id-{{ section.id }}" class="{% if section.settings.overlap_header %}header-overlap-section needs-alt-logo{% endif %}">
<section
  class="{{ section_classes }} {% if section.settings.sticky_desktop %}is-sticky-desktop{% endif %} {% if section.settings.sticky_mobile_item %}is-sticky-mobile{% endif %}"
  data-section-id="{{ section.id }}"
  data-cols-mobile="{{ cols_mobile }}"
  data-cols-desktop="{{ cols_desktop }}"
  style="--sticky-offset-desktop: {{ section.settings.sticky_offset_desktop }}px; --sticky-offset-mobile: {{ section.settings.sticky_offset_mobile }}px; --sticky-z-index: {{ section.settings.sticky_z_index }};"
>
  <style>
    .two-banner--{{ section.id }} .two-banner__grid {
      display: grid;
      grid-template-columns: repeat({{ cols_mobile }}, minmax(0, 1fr));
      gap: {{ section.settings.gap }}px;
    }

    @media (min-width: 750px) {
      .two-banner--{{ section.id }} .two-banner__grid {
        grid-template-columns: repeat({{ cols_desktop }}, minmax(0, 1fr));
      }
    }

    .two-banner--{{ section.id }} .two-banner__item { position: relative; overflow: hidden; }

    .two-banner--{{ section.id }} .two-banner__media img,
    .two-banner--{{ section.id }} .two-banner__media video,
    .two-banner--{{ section.id }} .two-banner__media iframe {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .two-banner--{{ section.id }} .two-banner__media {
      aspect-ratio: var(--ratio-mobile, 1.7778);
    }

    @media (min-width: 769px) {
      .two-banner--{{ section.id }} .two-banner__media {
        aspect-ratio: var(--ratio-desktop, var(--ratio-mobile, 1.7778));
      }
    }

    @media (min-width: 769px) {
      .two-banner--{{ section.id }}.is-sticky-desktop {
        position: sticky;
        top: var(--sticky-offset-desktop);
        z-index: var(--sticky-z-index);
      }
    }

    @media (max-width: 768px) {
      .two-banner--{{ section.id }}.is-sticky-mobile[data-cols-mobile="1"] .two-banner__item {
        position: sticky;
        top: var(--sticky-offset-mobile);
        z-index: var(--sticky-z-index);
      }
    }

    .two-banner--{{ section.id }} .two-banner__overlay {
      position: absolute;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 5;
      pointer-events: none;
    }

    .two-banner--{{ section.id }} .two-banner__overlay.h-left { justify-content: flex-start; }
    .two-banner--{{ section.id }} .two-banner__overlay.h-right { justify-content: flex-end; }
    .two-banner--{{ section.id }} .two-banner__overlay.v-top { align-items: flex-start; }
    .two-banner--{{ section.id }} .two-banner__overlay.v-bottom { align-items: flex-end; }

    .two-banner--{{ section.id }} .two-banner__title-wrapper {
      color: var(--title-color);
      background: var(--bg-color);
      transform: translate(var(--x), var(--y));
    }

    .two-banner--{{ section.id }} .two-banner__link {
      position: absolute;
      inset: 0;
      z-index: 10;
    }
  </style>

  <div class="two-banner__grid">
    {%- for block in section.blocks -%}
      <div class="two-banner__item" {{ block.shopify_attributes }}>
        <div class="two-banner__media" style="--ratio-mobile: 2/3; --ratio-desktop: 1/1;">
          {% if block.settings.image_desktop != blank %}
            <picture>
              <source media="(max-width: 768px)"
                      srcset="{{ block.settings.image_mobile | image_url: width: 1000 }}"
                      sizes="{{ mobile_vw }}vw">
              <source media="(min-width: 769px)"
                      srcset="{{ block.settings.image_desktop | image_url: width: 2000 }}"
                      sizes="{{ desktop_vw }}vw">
              <img src="{{ block.settings.image_desktop | image_url: width: 1200 }}"
                   alt="{{ block.settings.title | escape }}"
                   loading="lazy">
            </picture>
          {% endif %}
        </div>

        {% if block.settings.link != blank %}
          <a class="two-banner__link" href="{{ block.settings.link }}"></a>
        {% endif %}
      </div>
    {%- endfor -%}
  </div>
</section>
</div>

{% schema %}
{
  "name": "Two Banners",
  "settings": [
    { "type": "range", "id": "gap", "label": "Banner gap", "min": 0, "max": 64, "step": 1, "default": 0 },

    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Số banner / 1 hàng (Mobile)",
      "default": "1",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ]
    },

    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Số banner / 1 hàng (Desktop)",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 2
    },

    { "type": "checkbox", "id": "sticky_desktop", "label": "Sticky Desktop", "default": true },
    { "type": "checkbox", "id": "sticky_mobile_item", "label": "Sticky Mobile", "default": true },
    { "type": "range", "id": "sticky_offset_desktop", "label": "Offset Desktop", "min": 0, "max": 200, "step": 2, "default": 0 },
    { "type": "range", "id": "sticky_offset_mobile", "label": "Offset Mobile", "min": 0, "max": 200, "step": 2, "default": 0 },
    { "type": "range", "id": "sticky_z_index", "label": "Sticky Z-index", "min": 0, "max": 9900, "step": 100, "default": 1000 }
  ],
  "blocks": [
    {
      "type": "banner",
      "name": "Banner",
      "settings": [
        { "type": "image_picker", "id": "image_desktop", "label": "Ảnh Desktop" },
        { "type": "image_picker", "id": "image_mobile", "label": "Ảnh Mobile" },
        { "type": "url", "id": "link", "label": "Link" },
        { "type": "text", "id": "title", "label": "Title" }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    { "name": "Two Banners", "category": "Image" }
  ]
}
{% endschema %}
